!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=143)}({0:function(e,t){var n=e.exports={version:"2.5.7"};"number"==typeof __e&&(__e=n)},1:function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},10:function(e,t,n){var o=n(8);e.exports=function(e){if(!o(e))throw TypeError(e+" is not an object!");return e}},14:function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},143:function(e,t,n){"use strict";var o=c(n(16)),r=c(n(17)),i=c(n(45)),a=c(n(97)),u=c(n(54));function c(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(){(0,o.default)(this,e),this._recording=[],this._boundedMessageHandler=null,this._boundedNavigationHandler=null,this._boundedWaitHandler=null,this._boundedMenuHandler=null,this._boundedKeyCommandHandler=null,this._badgeState="",this._isPaused=!1,this._hasGoto=!1,this._hasViewPort=!1,this._menuId="PUPPETEER_RECORDER_CONTEXT_MENU",this._menuOptions={SCREENSHOT:"SCREENSHOT",SCREENSHOT_CLIPPED:"SCREENSHOT_CLIPPED"}}return(0,r.default)(e,[{key:"boot",value:function(){var e=this;chrome.extension.onConnect.addListener(function(t){console.debug("listeners connected"),t.onMessage.addListener(function(t){t.action&&t.action===u.default.START&&e.start(),t.action&&t.action===u.default.STOP&&e.stop(),t.action&&t.action===u.default.CLEAN_UP&&e.cleanUp(),t.action&&t.action===u.default.PAUSE&&e.pause(),t.action&&t.action===u.default.UN_PAUSE&&e.unPause()})})}},{key:"start",value:function(){var e=this;console.debug("start recording"),this.cleanUp(function(){e._badgeState="rec",e._hasGoto=!1,e._hasViewPort=!1,e.injectScript(),e._boundedMessageHandler=e.handleMessage.bind(e),e._boundedNavigationHandler=e.handleNavigation.bind(e),e._boundedWaitHandler=e.handleWait.bind(e),chrome.runtime.onMessage.addListener(e._boundedMessageHandler),chrome.webNavigation.onCompleted.addListener(e._boundedNavigationHandler),chrome.webNavigation.onBeforeNavigate.addListener(e._boundedWaitHandler),chrome.browserAction.setIcon({path:"./images/icon-green.png"}),chrome.browserAction.setBadgeText({text:e._badgeState}),chrome.browserAction.setBadgeBackgroundColor({color:"#FF0000"}),chrome.contextMenus.removeAll(),chrome.contextMenus.create({id:e._menuId,title:"Headless Recorder",contexts:["all"]}),chrome.contextMenus.create({id:e._menuId+e._menuOptions.SCREENSHOT,title:"Take Screenshot (Ctrl+Shift+A)",parentId:e._menuId,contexts:["all"]}),chrome.contextMenus.create({id:e._menuId+e._menuOptions.SCREENSHOT_CLIPPED,title:"Take Screenshot Clipped (Ctrl+Shift+S)",parentId:e._menuId,contexts:["all"]}),e._boundedMenuHandler=e.handleMenuInteraction.bind(e),chrome.contextMenus.onClicked.addListener(e._boundedMenuHandler),e._boundedKeyCommandHandler=e.handleKeyCommands.bind(e),chrome.commands.onCommand.addListener(e._boundedKeyCommandHandler)})}},{key:"stop",value:function(){console.debug("stop recording"),this._badgeState=this._recording.length>0?"1":"",chrome.runtime.onMessage.removeListener(this._boundedMessageHandler),chrome.webNavigation.onCompleted.removeListener(this._boundedNavigationHandler),chrome.webNavigation.onBeforeNavigate.removeListener(this._boundedWaitHandler),chrome.contextMenus.onClicked.removeListener(this._boundedMenuHandler),chrome.browserAction.setIcon({path:"./images/icon-black.png"}),chrome.browserAction.setBadgeText({text:this._badgeState}),chrome.browserAction.setBadgeBackgroundColor({color:"#45C8F1"}),chrome.storage.local.set({recording:this._recording},function(){console.debug("recording stored")})}},{key:"pause",value:function(){console.debug("pause"),this._badgeState="❚❚",chrome.browserAction.setBadgeText({text:this._badgeState}),this._isPaused=!0}},{key:"unPause",value:function(){console.debug("unpause"),this._badgeState="rec",chrome.browserAction.setBadgeText({text:this._badgeState}),this._isPaused=!1}},{key:"cleanUp",value:function(e){console.debug("cleanup"),this._recording=[],chrome.browserAction.setBadgeText({text:""}),chrome.storage.local.remove("recording",function(){console.debug("stored recording cleared"),e&&e()})}},{key:"recordCurrentUrl",value:function(e){this._hasGoto||(console.debug("recording goto* for:",e),this.handleMessage({selector:void 0,value:void 0,action:i.default.GOTO,href:e}),this._hasGoto=!0)}},{key:"recordCurrentViewportSize",value:function(e){this._hasViewPort||(this.handleMessage({selector:void 0,value:e,action:i.default.VIEWPORT}),this._hasViewPort=!0)}},{key:"recordNavigation",value:function(){this.handleMessage({selector:void 0,value:void 0,action:i.default.NAVIGATION})}},{key:"recordScreenshot",value:function(e){this.handleMessage({selector:void 0,value:e,action:i.default.SCREENSHOT})}},{key:"handleMessage",value:function(e,t){if(e.control)return this.handleControlMessage(e,t);e.frameId=t?t.frameId:null,e.frameUrl=t?t.url:null,this._isPaused||(this._recording.push(e),chrome.storage.local.set({recording:this._recording},function(){console.debug("stored recording updated")}))}},{key:"handleControlMessage",value:function(e,t){e.control===a.default.EVENT_RECORDER_STARTED&&chrome.browserAction.setBadgeText({text:this._badgeState}),e.control===a.default.GET_VIEWPORT_SIZE&&this.recordCurrentViewportSize(e.coordinates),e.control===a.default.GET_CURRENT_URL&&this.recordCurrentUrl(e.href),e.control===a.default.GET_SCREENSHOT&&this.recordScreenshot(e.value)}},{key:"handleNavigation",value:function(e){var t=e.frameId;console.debug("frameId is:",t),this.injectScript(),0===t&&this.recordNavigation()}},{key:"handleMenuInteraction",value:function(e,t){switch(console.debug("context menu clicked"),e.menuItemId){case this._menuId+this._menuOptions.SCREENSHOT:this.toggleScreenShotMode(u.default.TOGGLE_SCREENSHOT_MODE);break;case this._menuId+this._menuOptions.SCREENSHOT_CLIPPED:this.toggleScreenShotMode(u.default.TOGGLE_SCREENSHOT_CLIPPED_MODE)}}},{key:"handleKeyCommands",value:function(e){switch(e){case u.default.TOGGLE_SCREENSHOT_MODE:this.toggleScreenShotMode(u.default.TOGGLE_SCREENSHOT_MODE);break;case u.default.TOGGLE_SCREENSHOT_CLIPPED_MODE:this.toggleScreenShotMode(u.default.TOGGLE_SCREENSHOT_CLIPPED_MODE)}}},{key:"toggleScreenShotMode",value:function(e){console.debug("toggling screenshot mode"),chrome.tabs.query({active:!0,currentWindow:!0},function(t){chrome.tabs.sendMessage(t[0].id,{action:e})})}},{key:"handleWait",value:function(){chrome.browserAction.setBadgeText({text:"wait"})}},{key:"injectScript",value:function(){chrome.tabs.executeScript({file:"content-script.js",allFrames:!0})}}]),e}();console.debug("booting recording controller"),window.recordingController=new s,window.recordingController.boot()},16:function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},17:function(e,t,n){"use strict";t.__esModule=!0;var o=function(e){return e&&e.__esModule?e:{default:e}}(n(41));t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,o.default)(e,r.key,r)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()},2:function(e,t,n){e.exports=!n(9)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},22:function(e,t,n){var o=n(8);e.exports=function(e,t){if(!o(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!o(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!o(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!o(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},27:function(e,t,n){var o=n(8),r=n(1).document,i=o(r)&&o(r.createElement);e.exports=function(e){return i?r.createElement(e):{}}},31:function(e,t,n){var o=n(44);e.exports=function(e,t,n){if(o(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,o){return e.call(t,n,o)};case 3:return function(n,o,r){return e.call(t,n,o,r)}}return function(){return e.apply(t,arguments)}}},32:function(e,t,n){e.exports=!n(2)&&!n(9)(function(){return 7!=Object.defineProperty(n(27)("div"),"a",{get:function(){return 7}}).a})},4:function(e,t,n){var o=n(1),r=n(0),i=n(31),a=n(7),u=n(6),c=function(e,t,n){var s,d,l,f=e&c.F,_=e&c.G,h=e&c.S,E=e&c.P,g=e&c.B,S=e&c.W,p=_?r:r[t]||(r[t]={}),b=p.prototype,T=_?o:h?o[t]:(o[t]||{}).prototype;for(s in _&&(n=t),n)(d=!f&&T&&void 0!==T[s])&&u(p,s)||(l=d?T[s]:n[s],p[s]=_&&"function"!=typeof T[s]?n[s]:g&&d?i(l,o):S&&T[s]==l?function(e){var t=function(t,n,o){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,o)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(l):E&&"function"==typeof l?i(Function.call,l):l,E&&((p.virtual||(p.virtual={}))[s]=l,e&c.R&&b&&!b[s]&&a(b,s,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},41:function(e,t,n){e.exports={default:n(42),__esModule:!0}},42:function(e,t,n){n(43);var o=n(0).Object;e.exports=function(e,t,n){return o.defineProperty(e,t,n)}},43:function(e,t,n){var o=n(4);o(o.S+o.F*!n(2),"Object",{defineProperty:n(5).f})},44:function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},45:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={GOTO:"GOTO",VIEWPORT:"VIEWPORT",WAITFORSELECTOR:"WAITFORSELECTOR",NAVIGATION:"NAVIGATION",NAVIGATION_PROMISE:"NAVIGATION_PROMISE",FRAME_SET:"FRAME_SET",SCREENSHOT:"SCREENSHOT"}},5:function(e,t,n){var o=n(10),r=n(32),i=n(22),a=Object.defineProperty;t.f=n(2)?Object.defineProperty:function(e,t,n){if(o(e),t=i(t,!0),o(n),r)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},54:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={TOGGLE_SCREENSHOT_MODE:"TOGGLE_SCREENSHOT_MODE",TOGGLE_SCREENSHOT_CLIPPED_MODE:"TOGGLE_SCREENSHOT_CLIPPED_MODE",START:"START",STOP:"STOP",CLEAN_UP:"CLEAN_UP",PAUSE:"PAUSE",UN_PAUSE:"UN_PAUSE"}},6:function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},7:function(e,t,n){var o=n(5),r=n(14);e.exports=n(2)?function(e,t,n){return o.f(e,t,r(1,n))}:function(e,t,n){return e[t]=n,e}},8:function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},9:function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},97:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={EVENT_RECORDER_STARTED:"EVENT_RECORDER_STARTED",GET_VIEWPORT_SIZE:"GET_VIEWPORT_SIZE",GET_CURRENT_URL:"GET_CURRENT_URL",GET_SCREENSHOT:"GET_SCREENSHOT"}}});
//# sourceMappingURL=background.js.map